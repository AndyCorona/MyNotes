# 第三章 作用域

### 3.1 原始值与引用值

当把一个值赋给变量时，JavaScript 引擎必须确定是原始值还是引用值。Undefine、Null、Boolean、Number、String 和 Symbol 类型的都是原始值，Object 类型是引用值。

**动态属性**

引用值可以随时添加、修改和删除其属性和方法，原始值没有属性和方法。

```javascript
let person = new Object();
person.age = 29;
console.log(person.age); //29

let age=29;
age.name ="age";
console.log(age.name); //undefined
```

**复制值**

和 java 一样，原始值复制后，两个值各自独立存在，互不干扰。引用值复制的是指针，两个引用值仍然指向同一个对象。

**参数传递机制**

和 java 一样，所有函数的参数都是按值传递。
- 值传递：函数外的值会被复制到函数内的一个局部变量中；
- 引用传递：函数外的值在内存中的位置会被复制到函数内的一个局部变量中。

**确定类型**

和 java 一样，用 instanceof 关键字确定指定变量是否为指定类型的实例。

```javascript
let example = [1, 2];
//检测 example 是否为 Array 的实例
console.log(example instanceof Array); //true
```
### 3.2 作用域

任何变量都存在于某个作用域中，作用域决定了变量的生命周期。代码编写好后，变量分布在不同的作用域中，包括全局作用域、函数作用域、块作用域。不同作用域之间可以存在同名变量。

```javascript
//全局作用域
var a = 10;

//函数作用域
function app(){
    var a = 100;
}

//块作用域
if(true){
    var a = 20;
    console.log(a);
}
```

当执行代码时，会创建上下文对象，上下文对象包含以下信息：
- 变量对象：保存和提供当前作用域需要的变量和函数；
- 作用域链：保证变量和函数在不同作用域间被有序地访问；
- this：在当前上下文执行的对象。

#### 3.2.1 全局作用域

执行全局作用域中的代码时，创建一个全局上下文对象。变量对象为 global 对象（或 window）对象，function 声明的全局函数提升为变量对象的方法，var 定义的全局变量提升为变量对象的属性，this 指向 window 对象。

#### 3.2.2 函数作用域

每调用一次函数，就创建一个函数上下文对象。用实参赋值函数的形参，用实参列表赋值 arguments 对象，var 定义的局部变量提升为变量对象的属性，function 声明的全局函数提升为变量对象的方法，this 指向调用当前函数的对象。

#### 3.2.3 块作用域

级作用域由最近的一对包含花括号{}界定。

#### 3.2.4 变量查找

查找一个变量时，从作用域链前端开始找起。如果在局部上下文中找到该变量，则搜索停止，确定变量；如果没有找到变量名，则沿作用域链继续搜索。这个过程一直持续到搜索至全局上下文的变量对象。如果仍然没有找到标识符，则该变量为未定义。